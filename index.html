<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Latin Rosary Pronunciation Trainer</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        
        body {
            font-family: 'Georgia', 'Times New Roman', serif;
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 50%, #0f3460 100%);
            min-height: 100vh;
            color: #e8e8e8;
            padding: 20px;
        }
        
        .container {
            max-width: 900px;
            margin: 0 auto;
        }
        
        h1 {
            text-align: center;
            color: #d4af37;
            margin-bottom: 20px;
            font-size: 1.8em;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.5);
        }
        
        /* Prayer Selection */
        .prayer-tabs {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            justify-content: center;
            margin-bottom: 25px;
        }
        
        .prayer-tab {
            padding: 10px 18px;
            background: rgba(212, 175, 55, 0.15);
            border: 1px solid #d4af37;
            border-radius: 25px;
            color: #d4af37;
            cursor: pointer;
            font-size: 0.95em;
            transition: all 0.3s;
        }
        
        .prayer-tab:hover, .prayer-tab.active {
            background: #d4af37;
            color: #1a1a2e;
        }
        
        /* Chant Display Section */
        .chant-section {
            background: rgba(0,0,0,0.3);
            border-radius: 12px;
            padding: 25px;
            margin-bottom: 25px;
            border: 1px solid rgba(212, 175, 55, 0.3);
        }
        
        .chant-title {
            text-align: center;
            color: #d4af37;
            font-size: 1.4em;
            margin-bottom: 20px;
            font-variant: small-caps;
            letter-spacing: 2px;
        }
        
        .chant-text {
            font-size: 1.25em;
            line-height: 2.4;
            text-align: center;
            font-style: italic;
            overflow: visible;
        }
        
        .chant-phrase {
            display: inline-block;
            position: relative;
            cursor: pointer;
            padding: 2px 6px;
            border-radius: 3px;
            transition: all 0.2s;
        }
        
        .chant-phrase:hover {
            background: rgba(212, 175, 55, 0.2);
            color: #d4af37;
        }
        
        /* Tooltip for hover translation */
        .chant-phrase::after {
            content: attr(data-english);
            position: absolute;
            bottom: 100%;
            left: 50%;
            transform: translateX(-50%);
            background: #d4af37;
            color: #1a1a2e;
            padding: 6px 12px;
            border-radius: 6px;
            font-size: 0.7em;
            font-style: normal;
            white-space: nowrap;
            opacity: 0;
            visibility: hidden;
            pointer-events: none;
            transition: opacity 0.2s, visibility 0.2s;
            z-index: 1000;
            margin-bottom: 5px;
        }
        
        .chant-phrase:hover::after {
            opacity: 1;
            visibility: visible;
        }
        
        /* Full Prayer Audio Control */
        .full-audio-section {
            display: flex;
            justify-content: center;
            gap: 15px;
            margin-bottom: 25px;
        }
        
        .full-audio-btn {
            padding: 12px 25px;
            background: linear-gradient(135deg, #d4af37, #b8960c);
            border: none;
            border-radius: 25px;
            color: #1a1a2e;
            font-size: 1em;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .full-audio-btn:hover {
            transform: scale(1.05);
            box-shadow: 0 4px 15px rgba(212, 175, 55, 0.4);
        }
        
        .full-audio-btn.playing {
            background: linear-gradient(135deg, #4ade80, #22c55e);
        }
        
        /* Phrase Drill Section */
        .drill-section {
            background: rgba(0,0,0,0.2);
            border-radius: 12px;
            padding: 20px;
        }
        
        .drill-header {
            text-align: center;
            color: #d4af37;
            margin-bottom: 15px;
            font-size: 1.1em;
        }
        
        .phrase-grid {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }
        
        .phrase-row {
            display: grid;
            grid-template-columns: 50px 1fr auto;
            gap: 12px;
            align-items: center;
            padding: 12px 15px;
            background: rgba(255,255,255,0.03);
            border-radius: 8px;
            border: 1px solid rgba(255,255,255,0.05);
            transition: all 0.2s;
            cursor: pointer;
        }
        
        .phrase-row:hover {
            background: rgba(255,255,255,0.08);
            border-color: rgba(212, 175, 55, 0.3);
        }
        
        .phrase-row:active {
            transform: scale(0.99);
        }
        
        .phrase-row.playing {
            background: rgba(212, 175, 55, 0.15);
            border-color: #d4af37;
        }
        
        .phrase-play-btn {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: rgba(212, 175, 55, 0.2);
            border: 2px solid #d4af37;
            color: #d4af37;
            font-size: 1.1em;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.2s;
        }
        
        .phrase-play-btn:hover {
            background: #d4af37;
            color: #1a1a2e;
        }
        
        .phrase-play-btn.playing {
            background: #4ade80;
            border-color: #4ade80;
            color: #1a1a2e;
        }
        
        .phrase-text {
            display: flex;
            flex-direction: column;
            gap: 3px;
        }
        
        .phrase-latin {
            font-size: 1.1em;
            color: #fff;
            font-style: italic;
        }
        
        .phrase-english {
            font-size: 0.85em;
            color: #888;
        }
        
        .loop-toggle {
            padding: 6px 12px;
            background: rgba(74, 222, 128, 0.1);
            border: 1px solid rgba(74, 222, 128, 0.3);
            border-radius: 15px;
            color: #4ade80;
            font-size: 0.8em;
            cursor: pointer;
            transition: all 0.2s;
        }
        
        .loop-toggle:hover {
            background: rgba(74, 222, 128, 0.2);
        }
        
        .loop-toggle.active {
            background: #4ade80;
            color: #1a1a2e;
        }
        
        /* Hidden video element */
        #hiddenVideo {
            display: none;
        }
        
        /* Instructions */
        .instructions {
            text-align: center;
            margin-top: 20px;
            padding: 15px;
            background: rgba(0,0,0,0.2);
            border-radius: 8px;
            font-size: 0.85em;
            color: #888;
        }
        
        .instructions strong { color: #d4af37; }
        
        footer {
            text-align: center;
            margin-top: 25px;
            color: #666;
            font-size: 0.8em;
        }
        
        footer a { color: #d4af37; }
        
        @media (max-width: 600px) {
            .phrase-row {
                grid-template-columns: 40px 1fr;
            }
            .loop-toggle {
                display: none;
            }
            .chant-text {
                font-size: 1.1em;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üôè Latin Rosary Pronunciation Trainer</h1>
        
        <div class="prayer-tabs" id="prayerTabs">
            <button class="prayer-tab active" data-prayer="pater">Pater Noster</button>
            <button class="prayer-tab" data-prayer="ave">Ave Mar√≠a</button>
            <button class="prayer-tab" data-prayer="gloria">Gl√≥ria Patri</button>
            <button class="prayer-tab" data-prayer="credo">Credo</button>
            <button class="prayer-tab" data-prayer="salve">Salve Reg√≠na</button>
        </div>
        
        <!-- Chant Display -->
        <div class="chant-section">
            <div class="chant-title" id="chantTitle">Pater Noster</div>
            <div class="chant-text" id="chantText"></div>
        </div>
        
        <!-- Full Prayer Audio -->
        <div class="full-audio-section">
            <button class="full-audio-btn" id="playFullBtn">‚ñ∂ Play Full Prayer</button>
        </div>
        
        <!-- Phrase Drill Section -->
        <div class="drill-section">
            <div class="drill-header">Click any phrase to practice pronunciation:</div>
            <div class="phrase-grid" id="phraseGrid"></div>
        </div>
        
        <div class="instructions">
            <strong>Click</strong> a phrase to hear it ‚Ä¢ 
            <strong>üîÅ Loop</strong> to repeat continuously
        </div>
        
        <!-- Chant Video Section -->
        <div class="chant-video-section" style="margin-top: 25px; background: rgba(0,0,0,0.3); border-radius: 12px; padding: 20px; border: 1px solid rgba(212, 175, 55, 0.3);">
            <div style="text-align: center; color: #d4af37; font-size: 1.2em; margin-bottom: 15px; font-variant: small-caps;">Chanted Version</div>
            <div style="text-align: center;">
                <a id="chantVideoLink" href="#" target="_blank" style="display: inline-flex; align-items: center; gap: 10px; padding: 15px 30px; background: linear-gradient(135deg, #c4302b, #8b0000); border-radius: 8px; color: white; text-decoration: none; font-size: 1.1em; transition: all 0.3s; box-shadow: 0 4px 15px rgba(0,0,0,0.3);">
                    <svg width="24" height="24" viewBox="0 0 24 24" fill="white"><path d="M19.615 3.184c-3.604-.246-11.631-.245-15.23 0-3.897.266-4.356 2.62-4.385 8.816.029 6.185.484 8.549 4.385 8.816 3.6.245 11.626.246 15.23 0 3.897-.266 4.356-2.62 4.385-8.816-.029-6.185-.484-8.549-4.385-8.816zm-10.615 12.816v-8l8 3.993-8 4.007z"/></svg>
                    Watch Chanted Prayer on YouTube
                </a>
            </div>
        </div>
        
        <footer>
            <p>Audio from <a href="https://www.prayinglatin.com" target="_blank">PrayingLatin.com</a></p>
            <p style="margin-top:8px; font-style:italic;">Ad Majorem Dei Gloriam ‚úùÔ∏è</p>
        </footer>
    </div>
    
    <!-- Hidden video for audio playback -->
    <video id="hiddenVideo" preload="auto"></video>

    <script>
        // Audio player for full prayer MP3s
        let fullPrayerAudio = new Audio();
        
        fullPrayerAudio.addEventListener('ended', function() {
            document.getElementById('playFullBtn').classList.remove('playing');
            document.getElementById('playFullBtn').textContent = '‚ñ∂ Play Full Prayer';
        });
        
        function playFullPrayerAudio(url) {
            fullPrayerAudio.src = url;
            fullPrayerAudio.play();
            document.getElementById('playFullBtn').classList.add('playing');
            document.getElementById('playFullBtn').textContent = '‚èπ Stop';
        }
        
        function stopFullPrayerAudio() {
            fullPrayerAudio.pause();
            fullPrayerAudio.currentTime = 0;
            document.getElementById('playFullBtn').classList.remove('playing');
            document.getElementById('playFullBtn').textContent = '‚ñ∂ Play Full Prayer';
        }
        
        const prayers = {
            pater: {
                title: "Pater Noster",
                video: "https://www.prayinglatin.com/wp-content/uploads/2021/07/Pater-Noster-Learn.mp4",
                chantYouTube: "Zt9zteApmdA",
                spokenMp3: "https://www.boston-catholic-journal.com/preces-catholicae-sacrosanctae/traditional-catholic-prayers-in-latin-only/2-pater-noster-our-father-030616.mp3",
                phrases: [
                    { start: 0, end: 5, latin: "Pater noster", english: "Our Father" },
                    { start: 5, end: 12, latin: "qui es in c«Ωlis", english: "who art in heaven" },
                    { start: 12, end: 18, latin: "sanctific√©tur", english: "hallowed be" },
                    { start: 18, end: 24, latin: "n√≥men t√∫um", english: "thy name" },
                    { start: 24, end: 30, latin: "Adv√©niat", english: "Thy kingdom come" },
                    { start: 30, end: 36, latin: "regnum t√∫um", english: "Thy kingdom" },
                    { start: 36, end: 45, latin: "f√≠at vol√∫ntas t√∫a", english: "Thy will be done" },
                    { start: 45, end: 54, latin: "sicut in c«Ωlo et in terra", english: "on earth as it is in heaven" },
                    { start: 54, end: 61, latin: "P√°nem n√≥strum", english: "bread our" },
                    { start: 61, end: 67, latin: "cotidi√°num", english: "daily" },
                    { start: 67, end: 75, latin: "da nobis h√≥die", english: "give us this day" },
                    { start: 75, end: 82, latin: "et dim√≠tte n√≥bis", english: "and forgive us" },
                    { start: 82, end: 89, latin: "d√©bita n√≥stra", english: "our trespasses" },
                    { start: 89, end: 96, latin: "sicut et nos", english: "as we also" },
                    { start: 96, end: 104, latin: "dim√≠ttimus", english: "we forgive" },
                    { start: 104, end: 112, latin: "debit√≥ribus n√≥stris", english: "those who trespass against us" },
                    { start: 112, end: 120, latin: "et ne nos ind√∫cas", english: "and lead us not" },
                    { start: 120, end: 128, latin: "in tentati√≥nem", english: "into temptation" },
                    { start: 128, end: 141, latin: "sed l√≠bera nos a malo. Amen.", english: "but deliver us from evil. Amen." }
                ]
            },
            ave: {
                title: "Ave Mar√≠a",
                video: "https://www.prayinglatin.com/wp-content/uploads/2021/08/Ave-Maria.mp4",
                chantYouTube: "aKb0BZOQ0XU",
                spokenMp3: "https://www.boston-catholic-journal.com/preces-catholicae-sacrosanctae/traditional-catholic-prayers-in-latin-only/3-ave-maria-hail-mary-030616.mp3",
                phrases: [
                    { start: 5, end: 11, latin: "√Åve Mar√≠a", english: "Hail Mary" },
                    { start: 11, end: 17, latin: "gr√°tia pl√©na", english: "full of grace" },
                    { start: 17, end: 25, latin: "D√≥minus t√©cum", english: "the Lord is with thee" },
                    { start: 25, end: 33, latin: "Bened√≠cta tu", english: "Blessed art thou" },
                    { start: 33, end: 41, latin: "in muli√©ribus", english: "among women" },
                    { start: 41, end: 49, latin: "et bened√≠ctus", english: "and blessed" },
                    { start: 49, end: 67, latin: "fructus ventris t√∫i, I√©sus", english: "the fruit of thy womb, Jesus" },
                    { start: 67, end: 75, latin: "S√°ncta Mar√≠a", english: "Holy Mary" },
                    { start: 75, end: 81, latin: "M√°ter D√©i", english: "Mother of God" },
                    { start: 81, end: 92, latin: "√≥ra pro n√≥bis peccat√≥ribus", english: "pray for us sinners" },
                    { start: 92, end: 100, latin: "nunc, et in h√≥ra", english: "now and at the hour" },
                    { start: 100, end: 108, latin: "m√≥rtis n√≥str√¶", english: "of our death" },
                    { start: 108, end: 118, latin: "Am√©n.", english: "Amen." }
                ]
            },
            gloria: {
                title: "Gl√≥ria Patri",
                video: "https://www.prayinglatin.com/wp-content/uploads/2021/08/Gloria-Patri-Latin.mp4",
                chantYouTube: "6n1MgDrM2xU",
                spokenMp3: "https://www.boston-catholic-journal.com/preces-catholicae-sacrosanctae/traditional-catholic-prayers-in-latin-only/04-gloria-patri-glory-be-to-the-father-030616.mp3",
                phrases: [
                    { start: 0, end: 8, latin: "Gl√≥ria P√°tri", english: "Glory be to the Father" },
                    { start: 8, end: 14, latin: "et F√≠lio", english: "and to the Son" },
                    { start: 14, end: 22, latin: "et Spir√≠tui S√°ncto", english: "and to the Holy Spirit" },
                    { start: 22, end: 32, latin: "Sicut √©rat in princ√≠pio", english: "As it was in the beginning" },
                    { start: 32, end: 40, latin: "et nunc et s√©mper", english: "is now and ever shall be" },
                    { start: 40, end: 52, latin: "et in s«Ωcula s√¶cul√≥rum", english: "world without end" },
                    { start: 52, end: 65, latin: "Amen.", english: "Amen." }
                ]
            },
            credo: {
                title: "Credo (Apostles' Creed)",
                video: "https://www.prayinglatin.com/wp-content/uploads/2021/08/The-Apostles-Creed-Latin-Rosary.mp4",
                chantYouTube: "IcC1Bp13n_4",
                spokenMp3: "https://www.boston-catholic-journal.com/preces-catholicae-sacrosanctae/traditional-catholic-prayers-in-latin-only/symbolum-apostolorum-apostles-creed.mp3",
                phrases: [
                    { start: 0, end: 10, latin: "Credo in D√©um", english: "I believe in God" },
                    { start: 10, end: 18, latin: "P√°trem omnipot√©ntem", english: "the Father almighty" },
                    { start: 18, end: 28, latin: "Creat√≥rem c«Ωli et t√©rr√¶", english: "Creator of heaven and earth" },
                    { start: 28, end: 40, latin: "Et in I√©sum Chr√≠stum", english: "And in Jesus Christ" },
                    { start: 40, end: 50, latin: "F√≠lium √©jus √∫nicum", english: "His only Son" },
                    { start: 50, end: 58, latin: "D√≥minum n√≥strum", english: "our Lord" },
                    { start: 58, end: 72, latin: "qui conc√©ptus est de Sp√≠ritu S√°ncto", english: "who was conceived by the Holy Spirit" },
                    { start: 72, end: 84, latin: "n√°tus ex Mar√≠a V√≠rgine", english: "born of the Virgin Mary" },
                    { start: 84, end: 96, latin: "p√°ssus sub P√≥ntio Pil√°to", english: "suffered under Pontius Pilate" },
                    { start: 96, end: 110, latin: "crucif√≠xus, m√≥rtuus, et sep√∫ltus", english: "was crucified, died, and was buried" },
                    { start: 110, end: 120, latin: "desc√©ndit ad √≠nferos", english: "He descended into hell" },
                    { start: 120, end: 132, latin: "t√©rtia die resurr√©xit a m√≥rtuis", english: "on the third day He rose from the dead" },
                    { start: 132, end: 142, latin: "asc√©ndit ad c«Ωlos", english: "He ascended into heaven" },
                    { start: 142, end: 156, latin: "sedet ad d√©xteram Dei P√°tris omnipot√©ntis", english: "sits at the right hand of God the Father almighty" },
                    { start: 156, end: 170, latin: "inde vent√∫rus est judic√°re vivos et m√≥rtuos", english: "from thence He shall come to judge the living and the dead" },
                    { start: 170, end: 182, latin: "Credo in Sp√≠ritum S√°nctum", english: "I believe in the Holy Spirit" },
                    { start: 182, end: 194, latin: "s√°nctam Eccl√©siam cath√≥licam", english: "the holy Catholic Church" },
                    { start: 194, end: 206, latin: "sanct√≥rum communi√≥nem", english: "the communion of saints" },
                    { start: 206, end: 216, latin: "remissi√≥nem peccat√≥rum", english: "the forgiveness of sins" },
                    { start: 216, end: 228, latin: "carnis resurrecti√≥nem", english: "the resurrection of the body" },
                    { start: 228, end: 240, latin: "vitam √¶t√©rnam", english: "and life everlasting" },
                    { start: 240, end: 301, latin: "Amen.", english: "Amen." }
                ]
            },
            salve: {
                title: "Salve Reg√≠na",
                video: "https://www.prayinglatin.com/wp-content/uploads/2021/08/Salve-Regina.mp4",
                chantYouTube: "p_P_72TmWQM",
                spokenMp3: "https://www.boston-catholic-journal.com/preces-catholicae-sacrosanctae/traditional-catholic-prayers-in-latin-only/08-salve-regina-hail-holy-queen-030616.mp3",
                phrases: [
                    { start: 0, end: 10, latin: "S√°lve Reg√≠na", english: "Hail Holy Queen" },
                    { start: 10, end: 18, latin: "M√°ter miseric√≥rdi√¶", english: "Mother of Mercy" },
                    { start: 18, end: 28, latin: "v√≠ta, dulc√©do", english: "our life, our sweetness" },
                    { start: 28, end: 36, latin: "et spes n√≥stra, s√°lve", english: "and our hope, hail" },
                    { start: 36, end: 48, latin: "Ad te clam√°mus", english: "To thee do we cry" },
                    { start: 48, end: 58, latin: "√©xsules f√≠lii H√©v√¶", english: "poor banished children of Eve" },
                    { start: 58, end: 70, latin: "Ad te suspir√°mus", english: "To thee do we send up our sighs" },
                    { start: 70, end: 82, latin: "gem√©ntes et fl√©ntes", english: "mourning and weeping" },
                    { start: 82, end: 94, latin: "in hac lacrim√°rum v√°lle", english: "in this valley of tears" },
                    { start: 94, end: 108, latin: "√âia ergo, advoc√°ta n√≥stra", english: "Turn then, most gracious advocate" },
                    { start: 108, end: 122, latin: "illos t√∫os miseric√≥rdes √≥culos", english: "thine eyes of mercy" },
                    { start: 122, end: 134, latin: "ad nos conv√©rte", english: "toward us" },
                    { start: 134, end: 150, latin: "Et I√©sum, bened√≠ctum fr√∫ctum v√©ntris t√∫i", english: "And after this our exile show unto us Jesus" },
                    { start: 150, end: 162, latin: "n√≥bis post hoc exs√≠lium ost√©nde", english: "the blessed fruit of thy womb" },
                    { start: 162, end: 172, latin: "O cl√©mens, O p√≠a", english: "O clement, O loving" },
                    { start: 172, end: 190, latin: "O dulcis V√≠rgo Mar√≠a", english: "O sweet Virgin Mary" }
                ]
            }
        };

        let currentPrayer = 'pater';
        let video = document.getElementById('hiddenVideo');
        let isLooping = false;
        let loopPhraseIndex = -1;
        let currentPhraseIndex = -1;

        // Initialize
        function init() {
            loadPrayer('pater');
            setupEventListeners();
        }

        function setupEventListeners() {
            // Prayer tab clicks
            document.querySelectorAll('.prayer-tab').forEach(tab => {
                tab.addEventListener('click', () => {
                    document.querySelectorAll('.prayer-tab').forEach(t => t.classList.remove('active'));
                    tab.classList.add('active');
                    loadPrayer(tab.dataset.prayer);
                });
            });

            // Play full button
            document.getElementById('playFullBtn').addEventListener('click', playFull);

            // Video time update for looping
            video.addEventListener('timeupdate', handleTimeUpdate);
            video.addEventListener('ended', handleEnded);
        }

        function loadPrayer(prayerKey) {
            currentPrayer = prayerKey;
            const prayer = prayers[prayerKey];
            
            // Update title
            document.getElementById('chantTitle').textContent = prayer.title;
            
            // Build chant text with hover tooltips
            const chantText = prayer.phrases.map((phrase, idx) => 
                `<span class="chant-phrase" data-english="${phrase.english}" data-idx="${idx}">${phrase.latin}</span>`
            ).join(' ');
            document.getElementById('chantText').innerHTML = chantText;
            
            // Build phrase grid
            const grid = document.getElementById('phraseGrid');
            grid.innerHTML = prayer.phrases.map((phrase, idx) => `
                <div class="phrase-row" data-idx="${idx}">
                    <button class="phrase-play-btn" data-idx="${idx}">‚ñ∂</button>
                    <div class="phrase-text">
                        <div class="phrase-latin">${phrase.latin}</div>
                        <div class="phrase-english">${phrase.english}</div>
                    </div>
                    <button class="loop-toggle" data-idx="${idx}">üîÅ Loop</button>
                </div>
            `).join('');
            
            // Add click listeners
            grid.querySelectorAll('.phrase-row').forEach(row => {
                row.addEventListener('click', (e) => {
                    // Don't trigger if clicking the loop button
                    if (!e.target.classList.contains('loop-toggle')) {
                        playPhrase(parseInt(row.dataset.idx));
                    }
                });
            });
            
            grid.querySelectorAll('.loop-toggle').forEach(btn => {
                btn.addEventListener('click', (e) => {
                    e.stopPropagation();
                    toggleLoop(parseInt(btn.dataset.idx));
                });
            });
            
            // Chant phrase clicks
            document.querySelectorAll('.chant-phrase').forEach(span => {
                span.addEventListener('click', () => playPhrase(parseInt(span.dataset.idx)));
            });
            
            // Load video source
            video.src = prayer.video;
            video.load();
            
            // Set chant YouTube link
            const chantLink = document.getElementById('chantVideoLink');
            if (prayer.chantYouTube) {
                chantLink.href = `https://www.youtube.com/watch?v=${prayer.chantYouTube}`;
            }
            
            // Reset state
            stopAudio();
        }

        function playPhrase(idx) {
            const prayer = prayers[currentPrayer];
            const phrase = prayer.phrases[idx];
            
            // Make sure we're not in "full prayer" mode
            document.getElementById('playFullBtn').classList.remove('playing');
            document.getElementById('playFullBtn').textContent = '‚ñ∂ Play Full Prayer';
            
            currentPhraseIndex = idx;
            video.currentTime = phrase.start;
            video.play();
            
            updatePlayingUI(idx);
        }

        function playFull() {
            const prayer = prayers[currentPrayer];
            const btn = document.getElementById('playFullBtn');
            
            // If already playing, stop
            if (btn.classList.contains('playing')) {
                stopFullPrayerAudio();
                video.pause();
                return;
            }
            
            // Stop any phrase playback
            stopAudio();
            
            // If spoken MP3 is available, use it
            if (prayer.spokenMp3) {
                playFullPrayerAudio(prayer.spokenMp3);
                return;
            }
            
            // Fallback to MP4 video
            isLooping = false;
            loopPhraseIndex = -1;
            video.currentTime = 0;
            video.play();
            
            btn.classList.add('playing');
            btn.textContent = '‚èπ Stop';
        }

        function stopAudio() {
            video.pause();
            stopFullPrayerAudio();
            isLooping = false;
            loopPhraseIndex = -1;
            currentPhraseIndex = -1;
            
            // Reset UI
            document.querySelectorAll('.phrase-row').forEach(row => row.classList.remove('playing'));
            document.querySelectorAll('.phrase-play-btn').forEach(btn => btn.classList.remove('playing'));
            document.querySelectorAll('.loop-toggle').forEach(btn => btn.classList.remove('active'));
            document.getElementById('playFullBtn').classList.remove('playing');
            document.getElementById('playFullBtn').textContent = '‚ñ∂ Play Full Prayer';
        }

        function toggleLoop(idx) {
            if (loopPhraseIndex === idx) {
                // Turn off loop
                isLooping = false;
                loopPhraseIndex = -1;
                document.querySelectorAll('.loop-toggle').forEach(btn => btn.classList.remove('active'));
            } else {
                // Turn on loop for this phrase
                isLooping = true;
                loopPhraseIndex = idx;
                document.querySelectorAll('.loop-toggle').forEach(btn => btn.classList.remove('active'));
                document.querySelector(`.loop-toggle[data-idx="${idx}"]`).classList.add('active');
                playPhrase(idx);
            }
        }

        function handleTimeUpdate() {
            const prayer = prayers[currentPrayer];
            const currentTime = video.currentTime;
            
            // If playing a specific phrase (not full prayer), stop at end of phrase
            if (currentPhraseIndex >= 0 && !document.getElementById('playFullBtn').classList.contains('playing')) {
                const phrase = prayer.phrases[currentPhraseIndex];
                
                if (currentTime >= phrase.end - 0.1) {
                    if (isLooping && loopPhraseIndex === currentPhraseIndex) {
                        // Loop back to start of this phrase
                        video.currentTime = phrase.start;
                    } else {
                        // Stop at end of phrase
                        video.pause();
                        updatePlayingUI(-1);
                        currentPhraseIndex = -1;
                    }
                    return;
                }
            }
            
            // Update UI to show which phrase is playing (for full prayer playback)
            for (let i = 0; i < prayer.phrases.length; i++) {
                if (currentTime >= prayer.phrases[i].start && currentTime < prayer.phrases[i].end) {
                    if (currentPhraseIndex !== i) {
                        currentPhraseIndex = i;
                        updatePlayingUI(i);
                    }
                    break;
                }
            }
        }

        function handleEnded() {
            if (isLooping && loopPhraseIndex >= 0) {
                playPhrase(loopPhraseIndex);
            } else {
                stopAudio();
            }
        }

        function updatePlayingUI(idx) {
            // Update phrase rows
            document.querySelectorAll('.phrase-row').forEach((row, i) => {
                row.classList.toggle('playing', i === idx);
            });
            document.querySelectorAll('.phrase-play-btn').forEach((btn, i) => {
                btn.classList.toggle('playing', i === idx);
            });
        }

        // Initialize on load
        init();
    </script>
</body>
</html>
